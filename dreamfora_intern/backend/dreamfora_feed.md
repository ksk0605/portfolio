# **í”¼ë“œ ì¡°íšŒ ì‹œ ë°œìƒí•œ ë°ë“œë½ ë¬¸ì œ ê°œì„  ë° ì„±ëŠ¥ ìµœì í™”**  
> **ì´ ë¬¸ì„œì˜ ì½”ë“œëŠ” ì‹¤ì œ íšŒì‚¬ ì½”ë“œê°€ ì•„ë‹ˆë¼, ìœ ì‚¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ê³¼ì •ì„ ì„¤ëª…í•˜ê¸° ìœ„í•´ ì‘ì„±ëœ ì˜ˆì œ ì½”ë“œì…ë‹ˆë‹¤.**  
> **í´ë˜ìŠ¤ëª…, ë©”ì„œë“œëª…, ë¡œì§ ì¼ë¶€ê°€ ë³€ê²½ë˜ì–´ ìˆìœ¼ë©°, í•µì‹¬ í•´ê²° ì›ë¦¬ëŠ” ìœ ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.**  

---

## **ğŸ“Œ ë¬¸ì œ ìƒí™©: í”¼ë“œ ì¡°íšŒ APIì—ì„œ ë°œìƒí•˜ëŠ” ë°ë“œë½**  
- **ë“œë¦¼í¬ë¼ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©ìë“¤ì´ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ê°€ í”¼ë“œ ì¡°íšŒ ê¸°ëŠ¥ì´ì—ˆìŒ**  
- **ê·¸ëŸ¬ë‚˜ í”¼ë“œ ì¡°íšŒ APIì—ì„œ ê°„í—ì ìœ¼ë¡œ ë°ë“œë½ì´ ë°œìƒí•˜ëŠ” ë¬¸ì œê°€ í™•ì¸ë¨**  

#### **ğŸ” ì„œë²„ ë¡œê·¸ ë¶„ì„ ê²°ê³¼ (ë°ë“œë½ ë°œìƒ)**
```json
{
  "httpStatus" : "BAD_REQUEST",
  "apiVersion" : "1.1.0",
  "timestamp" : "2025-02-03 15:06:54",
  "endpoint" : "GET /v2/feeds/detail",
  "code" : 400,
  "message" : "(conn=11180662) Deadlock found when trying to get lock; try restarting transaction",
  "data" : "java.sql.SQLTransactionRollbackException"
}
```
âœ… **SQLTransactionRollbackExceptionì´ ë°œìƒí•˜ë©°, Deadlockì´ ê°ì§€ë¨**  
âœ… **íŠ¹ì • ì‚¬ìš©ìê°€ í”¼ë“œ ì¡°íšŒë¥¼ ìš”ì²­í•  ë•Œ, íŠ¸ëœì­ì…˜ ì¶©ëŒë¡œ ì¸í•´ API ì‘ë‹µì´ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°ê°€ ë°œìƒ**  

---

## **ğŸ“Œ ì›ì¸ ë¶„ì„: ì¡°íšŒ ë¡œì§ê³¼ ì—…ë°ì´íŠ¸ ë¡œì§ì´ ì„ì—¬ ìˆì–´ íŠ¸ëœì­ì…˜ì´ ê¸¸ì–´ì§**
ğŸ“Œ **CQRS íŒ¨í„´ì„ ë”°ë¥´ëŠ” ì¿¼ë¦¬ ì„œë¹„ìŠ¤ì„ì—ë„ ë¶ˆêµ¬í•˜ê³ , ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸ ë¡œì§ì´ í¬í•¨ë˜ì–´ ìˆì—ˆìŒ**  

#### **ğŸ” ê¸°ì¡´ ì½”ë“œ êµ¬ì¡° (ì˜ˆì œ ì½”ë“œ, ì‹¤ì œ ì½”ë“œ ì•„ë‹˜)**
```java
// ğŸ“Œ ì´ ì½”ë“œëŠ” ì‹¤ì œ íšŒì‚¬ ì½”ë“œê°€ ì•„ë‹Œ, ìœ ì‚¬í•œ ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ì˜ˆì œ ì½”ë“œì…ë‹ˆë‹¤.
@Transactional
public FeedDetailResponse getFeedDetails(Long userId, Long feedId) {
    FeedEntity feed = feedRepository.findById(feedId)
            .orElseThrow(() -> new NotFoundException("Feed not found: " + feedId));

    recordFeedView(new FeedView(userId, feedId));  // ğŸ”´ ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸ê°€ í¬í•¨ë¨

    return new FeedDetailResponse(fetchFeedData(userId, feed));
}

private void recordFeedView(FeedView feedView) {
    feedViewRepository.save(feedView);
    feedRepository.updateViewCount(feedView.getFeedId());  // ğŸ”´ ë™ê¸°ì ìœ¼ë¡œ ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸
}
```
âœ… **ì¡°íšŒ APIì„ì—ë„ ë¶ˆí•„ìš”í•˜ê²Œ DB íŠ¸ëœì­ì…˜ì´ ë°œìƒí•˜ê³  ìˆì—ˆìŒ**  
âœ… **ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ì´ ë™ì¼í•œ í”¼ë“œì— ì ‘ê·¼í•  ê²½ìš°, íŠ¸ëœì­ì…˜ ì¶©ëŒë¡œ ì¸í•´ ë°ë“œë½ ë°œìƒ ê°€ëŠ¥ì„± ì¦ê°€**  

---

## **ğŸ“Œ í•´ê²°ì±…ì„ ê³ ë¯¼í•˜ë©° ì‚¬ìš©ì ê²½í—˜ì„ ê³ ë ¤í•œ ì„ íƒ**  
ğŸ“Œ **ë°ë“œë½ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì—¬ëŸ¬ ê°€ì§€ ì˜µì…˜ì„ ê³ ë¯¼í•˜ë©°, ìµœì ì˜ ì‚¬ìš©ì ê²½í—˜ì„ ì œê³µí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì„ íƒ**  

### **ğŸš¨ í•´ê²° ì˜µì…˜ 1: ë°ì´í„°ë² ì´ìŠ¤ ë½ì„ í™œìš©í•˜ì—¬ ë™ì‹œì„± ë¬¸ì œ í•´ê²°** âŒ (ì±„íƒí•˜ì§€ ì•ŠìŒ)  
âœ… **ì¥ì :** ë½ì„ í™œìš©í•˜ë©´ ë™ì‹œ ìš”ì²­ì´ ë§ì•„ë„ ë°ì´í„° ì •í•©ì„±ì´ ìœ ì§€ë¨  
âŒ **ë‹¨ì :** ì‚¬ìš©ìì˜ ê²½í—˜ì´ ê°œì„ ë˜ì§€ ì•Šìœ¼ë©°, **ì˜¤íˆë ¤ API ì‘ë‹µ ì†ë„ê°€ ëŠë ¤ì§ˆ ìœ„í—˜**  

ğŸ“Œ **ì‚¬ìš©ì ì…ì¥ì—ì„œ í”¼ë“œ ì¡°íšŒëŠ” ë¹ ë¥´ê²Œ ì´ë£¨ì–´ì ¸ì•¼ í•˜ëŠ” ê¸°ëŠ¥ì¸ë°, ë½ì„ ê±¸ë©´ ë¶ˆí•„ìš”í•œ ëŒ€ê¸° ì‹œê°„ì´ ë°œìƒí•  ìˆ˜ ìˆìŒ**  

---

### **ğŸš€ í•´ê²° ì˜µì…˜ 2: ì¡°íšŒì™€ ì—…ë°ì´íŠ¸ë¥¼ ë¶„ë¦¬í•˜ê³ , ì¡°íšŒìˆ˜ ì¦ê°€ë¥¼ ë¹„ë™ê¸° ì²˜ë¦¬** âœ… (ì±„íƒí•œ ë°©ë²•)  
ğŸ“Œ **íŠ¸ëœì­ì…˜ì„ ì§§ê²Œ ìœ ì§€í•˜ë©´ì„œ, ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸ë¥¼ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•˜ë©´ ì„±ëŠ¥ì„ ìµœì í™”í•  ìˆ˜ ìˆìŒ**  
ğŸ“Œ **Spring Eventë¥¼ í™œìš©í•˜ì—¬, í”¼ë“œ ì¡°íšŒëŠ” ì¦‰ì‹œ ì‘ë‹µí•˜ê³  ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸ëŠ” ë³„ë„ ë¹„ë™ê¸° ì´ë²¤íŠ¸ë¡œ ì²˜ë¦¬**  
ğŸ“Œ **ì¡°íšŒìˆ˜ëŠ” ì‚¬ìš©ìê°€ ë‹¹ì¥ ì •í™•í•œ ì •ë³´ë¥¼ ë³´ê¸° ì›í•˜ëŠ” ë°ì´í„°ëŠ” ì•„ë‹ˆë¼ê³  íŒë‹¨, Eventual consistencyë¥¼ í™œìš©, ê²°ê³¼ì  ì¼ì¹˜ë¡œ ì¶©ë¶„í•˜ë‹¤ëŠ” ê²°ë¡ **  

---

#### **âœ… ê°œì„ ëœ ì½”ë“œ (ì˜ˆì œ ì½”ë“œ, ì‹¤ì œ ì½”ë“œ ì•„ë‹˜)**
```java
// ğŸ“Œ ì´ ì½”ë“œëŠ” ì‹¤ì œ íšŒì‚¬ ì½”ë“œê°€ ì•„ë‹Œ, ìœ ì‚¬í•œ ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ì˜ˆì œ ì½”ë“œì…ë‹ˆë‹¤.
@Transactional(readOnly = true)
public FeedDetailResponse getFeedDetails(Long userId, Long feedId) {
    FeedEntity feed = feedRepository.findById(feedId)
            .orElseThrow(() -> new NotFoundException("Feed not found: " + feedId));

    // âœ… ì¡°íšŒ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ì¦‰ì‹œ ì‘ë‹µ ë°˜í™˜
    eventPublisher.publishEvent(new FeedViewedEvent(userId, feedId));

    return new FeedDetailResponse(fetchFeedData(userId, feed));
}
```
âœ… **Spring Eventë¥¼ í™œìš©í•˜ì—¬ `FeedViewedEvent`ë¥¼ ë°œí–‰**  
âœ… **ì¡°íšŒëŠ” ì¦‰ì‹œ ë°˜í™˜í•˜ê³ , ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸ëŠ” ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬**  

#### **âœ… ë¹„ë™ê¸° ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸ ì²˜ë¦¬**
```java
// ğŸ“Œ ì´ ì½”ë“œëŠ” ì‹¤ì œ íšŒì‚¬ ì½”ë“œê°€ ì•„ë‹Œ, ìœ ì‚¬í•œ ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ì˜ˆì œ ì½”ë“œì…ë‹ˆë‹¤.
@Async
@Transactional(propagation = Propagation.REQUIRES_NEW)
@TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT, fallbackExecution = true)
public void handleFeedViewedEvent(FeedViewedEvent event) {
    try {
        feedViewRepository.save(new FeedViewEntity(event.getUserId(), event.getFeedId()));
        feedRepository.incrementViewCount(event.getFeedId());
    } catch (Exception error) {
        // ì‹¤íŒ¨ì‹œ ë¡œê¹… ì²˜ë¦¬
    }  
}
```
âœ… **ë¹„ë™ê¸°(`@Async`)ë¡œ ì‹¤í–‰ë˜ë¯€ë¡œ, API ì‘ë‹µ ì‹œê°„ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ**  
âœ… **ì¡°íšŒ APIëŠ” ì¦‰ì‹œ ë°˜í™˜í•˜ê³ , ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸ëŠ” ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰**  
âœ… **API ì¡°íšŒ ì•ˆì •ì„± ì¦ê°€ ë° ì‘ë‹µ ì†ë„ í–¥ìƒ**  

---
## **ê²°ë¡ **
- **ë°ë“œë½ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì—¬ëŸ¬ ì˜µì…˜ì„ ê³ ë¯¼í•˜ë©´ì„œ, ìµœì ì˜ ì‚¬ìš©ì ê²½í—˜ì„ ê³ ë ¤í•œ ë°©ì‹ ì„ íƒ**  
- **Spring Eventë¥¼ í™œìš©í•˜ì—¬ ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸ë¥¼ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•¨ìœ¼ë¡œì¨ API ì‘ë‹µ ì†ë„ í–¥ìƒ**  
- **íŠ¸ëœì­ì…˜ì„ ìµœì†Œí™”í•˜ì—¬, ë™ì‹œ ìš”ì²­ì´ ë§ì„ ë•Œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë³‘ëª© í˜„ìƒì„ ì™„í™”**  

